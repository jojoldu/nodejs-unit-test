# 1. 효율적으로 로그 모니터링하기 - WARN 레벨 활용하기

365/24 로 관리하는 시스템에서 로그는 굉장히 중요하다.  
하지만 로그가 중요하다는 생각에 무분별하게 남기는 것은 좋지 않다.
대표적으로 습관적으로 **예외 상황이 발생하면 ERROR 레벨로 로그**를 남기는 경우이다.  
  
보통의 서비스에서는 **정해진 시간 내 에러 로그가 일정 수치 이상 쌓이면 알람**을 발생시키도록 구성한다.  
정상적이지 않은 모든 상황에서 전부 ERROR 레벨로 처리하게 되면 불필요하게 많은 알람들로 인해 **정작 봐야할 심각한 에러 로그들도 놓칠 수 있다**.  
  
그래서 적정 수준에서 **로그 레벨을 구분하여 알람 경보 수준도 구분**하는 것이 필요하다.

## 로그 레벨

로그 수준 또는 로그 심각도 는 주어진 로그 메시지가 얼마나 중요한지를 알려주는 정보입니다.  
로그 이벤트를 서로 구별하는 간단하면서도 매우 강력한 방법입니다. 애플리케이션에서 로그 수준이 적절하게 사용되는 경우 먼저 심각도를 확인하는 것이 필요합니다. 대기 중인 밤에 계속 잠을 잘 수 있는지 또는 즉시 침대에서 일어나 거실의 침실과 노트북 사이를 달리며 또 다른 개인 최고 기록을 달성해야 하는지 알려줍니다.

로그 수준은 시스템 상태에 대한 중요한 정보와 순전히 유익한 정보를 필터링하는 방법으로 생각할 수 있습니다. 로그 수준은 정보 노이즈 및 경고 피로를 줄이는 데 도움이 될 수 있습니다 .

## 외부 API 연동

사내 서비스가 아닌 외부 API 서비스의 호출을 100% 성공하도록 관리하는 것은 불가능하다.  
따라서 이 호출의 일정 비율이 실패하는 것이 일상인 것을 어느정도 전제해야 한다.  

예를 들어 다음과 같이 API 연동이 있다고 가정해보자.

```ts
function get(url): string {
    try {
        return api.getCompanyInfo (url);
    } catch (Exception e) {
        log.error("Error occurred", e);
        return "A default response";
    }
}
```

트래픽이 많은 웹 애플리케이션의 경우 대략 외부 API의 실패율이 `0.1%`만 되어도 실패율은 초당 150개의 오류를 의미한다.  
따라서 각각을 오류로 기록하면 생산 로그에 대량의 노이즈가 생성된다.

```ts
function get(url): string {
    try {
        return api.getCompanyInfo (url);
    } catch (Exception e) {
        log.warn("Error occurred", e);
        return "A default response";
    }
}
```

`ERROR`로 기록하는 것보다 `WARN` 으로 기록하는 것이 좋다.

예외적으로 외부 API이지만 `ERROR` 레벨로 관리해야 하는 경우는 아래정도로 생각한다.

- 현재 트래픽 자체가 높지 않은 경우
  - 연동한 API가 하루 1%의 에러율을 가진다 하더라도 우리 트래픽이 낮아 하나하나의 요청 실패가 중요한 경우엔 그냥 다 ERROR로 처리한다.
- 결제와 같이 한번 실패시 치명적인 영향을 끼치는 서비스인 경우
  - 특히 별도로 [정산 대사](https://docs.tosspayments.com/guides/apis/settlements#%EC%A0%95%EC%82%B0-%EC%A1%B0%ED%9A%8C%ED%95%98%EA%B8%B0)를 시스템화 하지 않았다면 더더욱 중요하다. 
- 하루 1번, 한달에 1번 정도로 요청 자체가 주기적으로 적은 횟수만 수행하는 경우  



## 내부 시스템 연동

다만, 우리 내부의 시스템에 한해서는 `ERROR` 레벨로 관리한다.  
특히 RDS, Redis 등은 무조건 `ERROR` 레벨로 관리하며,  
**사내의 다른 팀 API는 에러율에 따라 적절하게 조정**한다.  




