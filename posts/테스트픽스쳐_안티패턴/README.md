# 테스트 픽스처 올바르게 사용하기

xUnit에서는 테스트 대상 시스템 (System Under Test, 이하 SUT) 를 실행하기 위해 해줘야 하는 모든 것을 **테스트 픽스처**라고 부른다.  
처음 테스트 코드를 배우게 되면 이 테스트 픽스처 부분에 대해서 완전히 오해하는 경우를 자주 본다.  
최근에 팀에 단위 테스트를 전파하고 코드리뷰를 진행하는 과정에서 다들 비슷한 오해를 하고 있는걸 발견하고 작성하게 되었다.

> 모든 코드는 TypeScript와 Jest로 작성되었다

## beforeEach (setup) 등 사용할 경우


일종의 훅 (Hook) 을 사용한 경우라 확실히 테스트 코드 중복 문제에 대처할 수 있고, 코드 길이도 줄어 코드 품질이 좋아졌다고 생각할 수 있다.  
하지만 이럴 경우 다른 문제점들이 생기게 된다. 

```typescript

```

### 문제점 1

코드를 보면 알겠지만, **어떤 상황(테스트 픽스처)일 경우에 이 기대값이 나오는지를 한 눈에 알 수가 없다**.  
이런 관계를 보려면 결국 `beforeEach` (혹은 `setup`) 로 가서 픽스처 코드를 다 봐야만 한다.

### 문제점 2

위와 같이 `beforeEach` (혹은 `setup`) 로 테스트 픽스처를 구성하게 되면 **해당 파일 (혹은 클래스) 안에서는 모든 테스트가 서로 결합되버린다**.  
테스트 픽스처의 코드 하나만 변경해도 **모든 테스트에 영향을 미친다**.  
  
```javascript
order.addPay (Pay.of(10000));
```

```javascript
order.addPay (Pay.of(15000));
```

테스트를 수정해도 **다른 테스트에 영향을 주어서는 안되게 하는 것**이 좋은 테스트의 기본조건이다.  
각각의 테스트 메소드들 간에 격리돼 실행하는 것과 마찬가지로, 테스트 픽스처 역시  

테스트 클래스 (혹은 `describe`) 에서는 절대 공유 상태를 두면 안된다고 생각하면 쉽다.  

> 여기서의 공유 상태란, 말 그대로 값을 가진 글로벌 변수(함수내 전역 변수, 혹은 인스턴스 변수) 에 해당한다.  


## 해결

테스트 픽스처를 위한 팩토리 메소드를 만든다.  
이는 해당 파일내 (혹은 해당 테스트 클래스) 내부에 두어도 되고, 외부에 별도의 클래스나 함수를 만들어서 사용해도 된다.

이렇게 하면,

* 전체 테스트 코드의 양이 줄어들고, 재사용성이 좋다
* 각각의 테스트 메소드의 가독성이 좋아지고, 맥락 파악이 쉬워진다.

## 마무리

테스트 메소드만으로 완전한 프로그램이 되어야 한다.
