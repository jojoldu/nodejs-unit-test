# Controller / Service 단위 테스트 하기

간혹 Controller와 Service를 항상 통합 테스트 혹은 E2E 테스트로만 작성하는 경우를 본다.  
프레임워크에 따라 다르겠지만, 모든 Controller와 Service를 통합 테스트 혹은 E2E 테스트로만 검증하기 보다는 상황에 따라 적절한 [테스트 더블](https://repo.yona.io/files/4000)을 사용하여 단위 테스트로 작성하는 것이 전체 테스트 속도 향상에 도움이 된다.  
  
## 예제


## 주의사항

이렇게 테스트 더블 (Stub/Mock) 혹은 Mock 라이브러리를 통해 처리하는 경우가 항상 옳은 것은 아니다.  
그래서 테스트 더블을 사용할수록 다음의 주의사항을 꼭 염두해 두어야만 한다.

### 점점 깨지기 쉬운 테스트가 된다

테스트 더블 객체들은 흔히 깨지기 쉬운 테스트 케이스가 되는 경향이 있다.  
이는 **Mock/Stub 처리를 위해 테스트가 그만큼 구현부를 상세하게 의존**함을 의미하기 때문이다.  

* [테스트 코드에서 내부 구현 검증 피하기](https://jojoldu.tistory.com/614)

가능하다면 **테스트 더블이 필요 없는 작은 구조**로 구현부의 설계를 개선하는 것이 좋다.
그 편이 테스트 더블을 사용 하려고 노력하는 것보다 훨씬 낫다.

### 어떤 Mock 라이브러리 & 프레임워크를 쓸지는 중요한 문제가 아니다

어떤 Mock 프레임워크를 사용할 것인지에 대해 지나치게 많은 고민을 하는 경우가 있다. 
그리고 어떤 Mock 프레임워크가 선정되느냐에 따라 향후 테스트 케이스 작성
에 커다란 영향을 미칠 것처럼 느껴질 수 있다. 하지만 사실은 그렇지 않다. 앞에서
소개한 어떤 Mock 프레임워크를 사용한다 하더라도 익숙해지기 전까지는 불편할
수밖에 없다. 그러니, 유행 따라 최고의 Mock 프레임워크를 찾아 떠나는 여정은 하지 않길 바란다. 앞에서도 살펴봤지만, 대부분의 경우 간단한 Mock 객체만으로도 충 분하다. 어떤 측면에서는 Mock 프레임워크를 사용했다는 것만으로도 이미 어려운
길에 들어서는 것이다.

### Mock은 Mock일 뿐이다
Mock 객체를 사용해 아무리 잘 작동하는 코드를 만들었다 하더라도, 실제 객체(real
object)가 끼어들어 왔을 때도 잘 동작하리라는 보장은 없다. 
Mock 객체는 실제 객
체나 실제 시스템에 대해 단지 흉내만, 그것도 오로지 당신이 원하는 형태로만 낼 뿐
이란 걸 잊어서는 안 된다. 결국 언제가 됐든, Mock 객체는 실제 객체로 대체되어 테
스트를 해야 하는 시점이 온다. 따라서 초반부터 실제 객체를 테스트에 사용할 수 있
다면, 그리고 그 비용이 많이 크지 않다면, Mock 객체를 사용하지 말자.



